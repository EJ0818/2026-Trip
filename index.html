<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…é‚è¡Œç¨‹åŠ©ç† - Zootopia Style</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Font Awesome åœ–ç¤º -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- è¼‰å…¥ Google Font: Nunito (åœ“æ½¤å‹å¥½) -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* è¨­ç½®å…¨åŸŸå­—é«”ç‚º Nunito */
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f7f9; /* Zootopia åŸå¸‚èƒŒæ™¯è‰²ï¼Œæ·ºè—ç° */
        }
        /* ä¸»å®¹å™¨æ¨£å¼ï¼Œé™åˆ¶å¯¬åº¦ä¸¦ç½®ä¸­ï¼Œç¢ºä¿æ‰‹æ©Ÿé«”é©— */
        #app-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            padding-bottom: 80px; /* ç•™å‡ºåº•éƒ¨å°èˆªçš„ç©ºé–“ */
        }
        /* éš±è—æœªé¸ä¸­çš„åˆ†é  */
        .tab-content:not(.active) {
            display: none;
        }
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ (åƒ…Chrome/Edge/Safari) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #90c74b; /* Zootopia ç¶ è‰² */
            border-radius: 10px;
        }
        /* è®“ input[type="file"] éš±è—ï¼Œä½¿ç”¨æŒ‰éˆ•è§¸ç™¼ */
        .file-input-container {
            display: inline-block;
        }
        .file-input-container input[type="file"] {
            display: none;
        }
        /* è¼”åŠ©å‡½æ•¸ï¼šå°‡ Base64 è½‰æ›ç‚º Blob çš„å‡½å¼ï¼ˆç”¨æ–¼åœ–ç‰‡è™•ç†ï¼‰ */
        /* Zootopia ç¶ è‰²æŒ‰éˆ•åŸºç¤æ¨£å¼ */
        .btn-zootopia-primary {
            background-color: #90c74b; /* Nick's Green */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 1.5rem; /* æ›´åŠ åœ“æ½¤ */
            font-weight: 700;
            box-shadow: 0 4px #6B8E23; /* è¼•å¾®é™°å½±ï¼Œå¢åŠ ç«‹é«”æ„Ÿ */
            transition: all 0.1s ease-in-out;
        }
        .btn-zootopia-primary:active {
            box-shadow: 0 2px #6B8E23;
            transform: translateY(2px);
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="app-container" class="bg-white shadow-2xl">

        <!-- é ‚éƒ¨æ¨™é¡Œå’Œå•å€™èª -->
        <header class="p-6 bg-[#4A90E2] text-white shadow-xl rounded-b-3xl mb-4">
            <h1 class="text-3xl font-extrabold flex items-center">
                <i class="fas fa-paw mr-2"></i> æ¸…é‚è¡Œç¨‹åŠ©ç†
            </h1>
            <p class="text-sm opacity-90 mt-1">ä¸€èµ·å‡ºé–€æ…¶ç¥å°å¯¶ä¸‰æ­²ç”Ÿæ—¥~</p>
        </header>

        <!-- å…§å®¹å€åŸŸ -->
        <main class="px-4 py-2">

            <!-- 1. PLAN (è¡Œç¨‹è¡¨) -->
            <section id="plan" class="tab-content active">
                <h2 class="text-2xl font-bold mb-4 text-[#4A90E2] border-b-2 border-[#90c74b] pb-2">
                    <i class="fas fa-route mr-2"></i> è¦åŠƒè¡Œç¨‹è¡¨
                </h2>
                <div class="space-y-6" id="itinerary-container">
                    <!-- è¡Œç¨‹å¡ç‰‡å°‡ç”± JS å¡«å…… -->
                </div>
            </section>

            <!-- 2. GUIDE (æ·±åº¦å°è¦½) -->
            <section id="guide" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-[#4A90E2] border-b-2 border-[#90c74b] pb-2">
                    <i class="fas fa-map-marked-alt mr-2"></i> æ·±åº¦å°è¦½
                </h2>

                <div class="bg-white p-5 rounded-3xl shadow-lg mb-6 border-l-4 border-[#F7D754]">
                    <h3 class="text-xl font-bold text-[#6B8E23] mb-3">ğŸ˜ Elephant Friend ä½å®¿èˆ‡é«”é©—</h3>
                    <p class="text-sm text-gray-700 leading-relaxed mb-4">
                        Elephant Friend ä½æ–¼æ¸…é‚éƒŠå€ï¼Œæä¾›ä¸€å€‹èˆ‡å¤§è±¡è¿‘è·é›¢æ¥è§¸çš„å‹å¥½ç’°å¢ƒã€‚é€™è£¡ä¸æ˜¯å‚³çµ±çš„è§€å…‰ç‡Ÿåœ°ï¼Œè€Œæ˜¯å°ˆæ³¨æ–¼å¤§è±¡ç¦ç¥‰çš„ä¿è­·å€ã€‚æˆ‘å€‘çš„ã€Œä¸€æ—¥å¥—è£è¡Œç¨‹ã€åŒ…å«äº†æº«å’Œçš„å¤§è±¡æ´—æ¾¡èˆ‡é¤µé£Ÿï¼Œä»¥åŠå……æ»¿è‡ªç„¶æ°£æ¯çš„ç«¹ç­æ¼‚æµå’Œç€‘å¸ƒé‡é¤ã€‚å°æ–¼å®¶åº­æ—…éŠä¾†èªªï¼Œé€™æ˜¯ä¸€å€‹é›£å¾—çš„ã€å¯Œæœ‰æ•™è‚²æ„ç¾©çš„é«”é©—ã€‚
                    </p>
                    <p class="text-sm font-semibold text-gray-500 mt-2">å†·çŸ¥è­˜ï¼šæˆå¹´å¤§è±¡æ¯å¤©éœ€è¦æ”å–ç´„ 150 å…¬æ–¤çš„é£Ÿç‰©ï¼</p>

                    <h4 class="text-lg font-bold mt-4 mb-2">åœ°åœ–å°è¦½ (Elephant friend)</h4>
                    <!-- OpenStreetMap iframeï¼Œä½¿ç”¨å¤§è‡´çš„æ¸…é‚åŒ—é‚Šå±±å€åº§æ¨™ -->
                    <div class="aspect-w-16 aspect-h-9 overflow-hidden rounded-xl shadow-inner">
                         <iframe width="100%" height="300" 
                            src="https://www.openstreetmap.org/export/embed.html?bbox=98.80%2C18.87%2C98.90%2C18.97&amp;layer=mapnik&amp;marker=18.92%2C98.85" 
                            style="border: 1px solid black; width: 100%; height: 100%;" allowfullscreen>
                        </iframe>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-3xl shadow-lg mb-6 border-l-4 border-[#F7D754]">
                    <h3 class="text-xl font-bold text-[#6B8E23] mb-3">ğŸ® æ¸…é‚å¤©ç‡ˆç¯€ (Yi Peng)</h3>
                    <p class="text-sm text-gray-700 leading-relaxed mb-4">
                        å¤©ç‡ˆç¯€æ˜¯æ¸…é‚æœ€å…·ä»£è¡¨æ€§çš„æ´»å‹•ä¹‹ä¸€ï¼Œé€šå¸¸åœ¨æ³°åœ‹çš„åäºŒæœˆæ»¿æœˆèˆ‰è¡Œï¼Œä¹Ÿè¢«ç¨±ç‚ºæ°´ç‡ˆç¯€ (Loi Krathong)ã€‚ç•¶æˆåƒä¸Šè¬çš„å­”æ˜ç‡ˆåŒæ™‚å‡ç©ºï¼Œç…§äº®å¤œç©ºæ™‚ï¼Œé‚£ä»½å£¯è§€èˆ‡æµªæ¼«ä»¤äººé›£å¿˜ã€‚æˆ‘å€‘çš„è¡Œç¨‹æ­£å¥½èƒ½åƒèˆ‡å…¶ä¸­ï¼Œè«‹å‹™å¿…æº–å‚™å¥½ç›¸æ©Ÿï¼
                    </p>
                    <p class="text-sm font-semibold text-gray-500 mt-2">æ³¨æ„äº‹é …ï¼šæ”¾å¤©ç‡ˆé€šå¸¸éœ€è¦æ”¯ä»˜é–€ç¥¨æˆ–å ´åœ°è²»ã€‚è«‹æ³¨æ„é¢¨å‘ä¸¦éµå®ˆå·¥ä½œäººå“¡æŒ‡ç¤ºã€‚</p>
                </div>
            </section>

            <!-- 3. WALLET (è¨˜å¸³èˆ‡åŒ¯ç‡) -->
            <section id="wallet" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-[#4A90E2] border-b-2 border-[#90c74b] pb-2">
                    <i class="fas fa-wallet mr-2"></i> è¨˜å¸³èˆ‡åŒ¯ç‡
                </h2>

                <!-- åŒ¯ç‡è¨ˆç®—æ©Ÿ -->
                <div class="bg-[#eaf1f7] p-4 rounded-2xl shadow-inner mb-6">
                    <h3 class="text-xl font-bold text-[#4A90E2] mb-3">å³æ™‚åŒ¯ç‡æ›ç®—</h3>
                    <p class="text-xs text-gray-500 mb-2">åŒ¯ç‡è¨­å®šï¼š1 THB (æ³°éŠ–) â‰ˆ 0.90 TWD (å°å¹£)</p>
                    <input type="text" id="calcInput" placeholder="è¼¸å…¥ç®—å¼ (e.g., 500+200*3)" 
                           class="w-full p-3 mb-3 border-2 border-[#90c74b] rounded-xl text-lg font-mono focus:ring-2 focus:ring-[#F7D754]">
                    <button onclick="calculateCurrency()" class="btn-zootopia-primary w-full text-lg">
                        <i class="fas fa-calculator mr-2"></i> è¨ˆç®—ä¸¦æ›ç®— (TWD)
                    </button>
                    <div id="calcResult" class="mt-4 p-3 bg-white rounded-xl shadow-md text-center">
                        <span class="text-sm text-gray-500">è¼¸å…¥ç®—å¼å¾Œï¼Œé»æ“Šè¨ˆç®—</span>
                    </div>
                </div>

                <!-- è¨˜å¸³åŠŸèƒ½ -->
                <div class="bg-white p-4 rounded-2xl shadow-lg border-t-4 border-[#90c74b]">
                    <h3 class="text-xl font-bold text-[#6B8E23] mb-3">æ–°å¢æ¶ˆè²»è¨˜éŒ„ (THB)</h3>
                    <form id="expenseForm" class="space-y-3">
                        <input type="text" id="expenseItem" placeholder="å“é …åç¨± (e.g., åˆé¤)" required
                               class="w-full p-3 border rounded-xl focus:border-[#4A90E2]">
                        <input type="number" id="expenseAmount" placeholder="æ³°éŠ–é‡‘é¡ (THB)" required
                               class="w-full p-3 border rounded-xl focus:border-[#4A90E2]" min="0">

                        <!-- æ‹ç…§/ä¸Šå‚³æŒ‰éˆ• -->
                        <div class="file-input-container">
                            <label for="expensePhoto" class="btn-zootopia-primary cursor-pointer text-sm">
                                <i class="fas fa-camera mr-2"></i> æ‹ç…§ / ä¸Šå‚³æ”¶æ“š
                            </label>
                            <input type="file" id="expensePhoto" accept="image/*" capture="camera">
                            <span id="photoStatus" class="ml-3 text-sm text-gray-500">æœªé¸å–åœ–ç‰‡</span>
                            <canvas id="photoCanvas" style="display: none;"></canvas>
                        </div>

                        <button type="submit" class="btn-zootopia-primary w-full mt-3">
                            <i class="fas fa-plus-circle mr-2"></i> å„²å­˜è¨˜éŒ„
                        </button>
                    </form>

                    <!-- è¨˜å¸³åˆ—è¡¨ -->
                    <h3 class="text-xl font-bold text-[#4A90E2] mt-6 mb-3 border-t pt-4">æ¶ˆè²»æ­·å²</h3>
                    <div id="expenseList" class="space-y-4">
                        <p class="text-center text-gray-400">å°šç„¡æ¶ˆè²»è¨˜éŒ„ã€‚</p>
                    </div>
                </div>
            </section>

            <!-- 4. LISTS (æ¸…å–®) -->
            <section id="lists" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-[#4A90E2] border-b-2 border-[#90c74b] pb-2">
                    <i class="fas fa-list-check mr-2"></i> æ¸…å–®èˆ‡å‚™å¿˜éŒ„
                </h2>

                <!-- å¿…å‚™æ¸…å–® CheckList -->
                <div class="bg-white p-5 rounded-3xl shadow-lg mb-6 border-l-4 border-[#90c74b]">
                    <h3 class="text-xl font-bold text-[#6B8E23] mb-3"><i class="fas fa-suitcase-rolling mr-2"></i> è¡Œå‰æº–å‚™ CheckList</h3>
                    <div id="checklistContainer" class="space-y-2">
                        <!-- Checklist items will be loaded here -->
                    </div>
                </div>

                <!-- å€‹äººå‚™å¿˜éŒ„ Memo -->
                <div class="bg-white p-5 rounded-3xl shadow-lg border-l-4 border-[#F7D754]">
                    <h3 class="text-xl font-bold text-[#4A90E2] mb-3"><i class="fas fa-lightbulb mr-2"></i> å€‹äººå‚™å¿˜éŒ„</h3>
                    <textarea id="memoTextarea" 
                              class="w-full p-3 border rounded-xl h-40 focus:border-[#4A90E2] resize-none" 
                              placeholder="è‡ªç”±è¼¸å…¥æ–‡å­—ï¼Œç¶²å€æœƒè‡ªå‹•è½‰æ›ç‚ºæŒ‰éˆ•..."></textarea>
                    <button onclick="saveMemo()" class="btn-zootopia-primary w-full mt-3 text-sm">
                        <i class="fas fa-save mr-2"></i> å„²å­˜å‚™å¿˜éŒ„
                    </button>

                    <div id="memoPreview" class="mt-4 p-3 bg-[#eaf1f7] rounded-xl text-sm whitespace-pre-wrap">
                        <!-- Memo preview will be shown here -->
                    </div>
                </div>
            </section>

            <!-- 5. INFO (è³‡è¨Š) -->
            <section id="info" class="tab-content">
                <h2 class="text-2xl font-bold mb-4 text-[#4A90E2] border-b-2 border-[#90c74b] pb-2">
                    <i class="fas fa-circle-info mr-2"></i> æ—…éŠè³‡è¨Šèˆ‡ç·Šæ€¥è¯çµ¡
                </h2>

                <!-- è³‡è¨Šå¡ç‰‡ï¼šå¤©æ°£ -->
                <div class="bg-white p-5 rounded-3xl shadow-lg mb-6 border-l-4 border-[#90c74b]">
                    <h3 class="text-xl font-bold text-[#6B8E23] mb-3"><i class="fas fa-cloud-sun-rain mr-2"></i> ç•¶åœ°å¤©æ°£</h3>
                    <p class="text-sm mb-3">æ¸…é‚ 11 æœˆåº•é€šå¸¸ç‚ºæ¶¼å­£ï¼Œæ°£å€™å®œäººï¼Œæ—©æ™šæº«å·®å¤§ï¼Œéœ€å‚™è–„å¤–å¥—ã€‚</p>
                    <a href="https://www.tmd.go.th/en" target="_blank" class="btn-zootopia-primary inline-block text-xs">
                        æŸ¥çœ‹æ³°åœ‹æ°£è±¡å±€é å ±
                    </a>
                </div>

                <!-- è³‡è¨Šå¡ç‰‡ï¼šç·Šæ€¥è¯çµ¡ -->
                <div class="bg-white p-5 rounded-3xl shadow-lg mb-6 border-l-4 border-[#F7D754]">
                    <h3 class="text-xl font-bold text-[#4A90E2] mb-3"><i class="fas fa-phone-volume mr-2"></i> ç·Šæ€¥è¯çµ¡è³‡è¨Š</h3>
                    <ul class="text-sm space-y-2">
                        <li><span class="font-semibold">è­¦å¯Ÿï¼š</span> 191</li>
                        <li><span class="font-semibold">æ•‘è­·è»Š/ç«è­¦ï¼š</span> 1669</li>
                        <li><span class="font-semibold">æ—…éŠè­¦å¯Ÿ (è‹±æ–‡)ï¼š</span> 1155</li>
                        <li><span class="font-semibold">é§æ³°åœ‹å°åŒ—ç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ï¼š</span> +66-81-666-4006</li>
                    </ul>
                </div>

                <!-- è³‡è¨Šå¡ç‰‡ï¼šæ—…éŠç¦å¿Œ -->
                <div class="bg-white p-5 rounded-3xl shadow-lg border-l-4 border-[#90c74b]">
                    <h3 class="text-xl font-bold text-[#6B8E23] mb-3"><i class="fas fa-triangle-exclamation mr-2"></i> æ—…éŠç¦å¿Œèˆ‡æ³¨æ„äº‹é …</h3>
                    <ul class="text-sm list-disc pl-5 space-y-2">
                        <li>è«‹å‹¿è§¸æ‘¸ä»–äººé ­éƒ¨ (è¦–ç‚ºèº«é«”æœ€ç¥è–çš„éƒ¨ä½)ã€‚</li>
                        <li>å¥³æ€§ä¸å¯ç¢°è§¸åƒ§ä¾¶ï¼Œå³ä½¿æ˜¯éæ±è¥¿ä¹Ÿè¦é€éç¬¬ä¸‰æ–¹ã€‚</li>
                        <li>å°åœ‹ç‹å’Œçš‡å®¤ä¿æŒå°Šæ•¬ï¼Œä¸è¦è©•è«–æˆ–åšå‡ºä¸æ•¬æ‰‹å‹¢ã€‚</li>
                        <li>å‡ºå…¥å¢ƒç¦å¸¶è‚‰è£½å“ã€æ–°é®®è”¬æœåŠç‰¹å®šè—¥å“ã€‚</li>
                    </ul>
                </div>
            </section>

        </main>

        <!-- åº•éƒ¨å°èˆªåˆ— -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-2xl z-50 rounded-t-3xl max-w-[600px] mx-auto">
            <div class="flex justify-around items-center h-16">
                <button onclick="switchTab('plan')" class="nav-btn flex flex-col items-center justify-center p-2 text-[#4A90E2]" data-tab="plan">
                    <i class="fas fa-route text-xl"></i>
                    <span class="text-xs mt-1 font-semibold">PLAN</span>
                </button>
                <button onclick="switchTab('guide')" class="nav-btn flex flex-col items-center justify-center p-2 text-gray-500" data-tab="guide">
                    <i class="fas fa-map-marked-alt text-xl"></i>
                    <span class="text-xs mt-1 font-semibold">GUIDE</span>
                </button>
                <button onclick="switchTab('wallet')" class="nav-btn flex flex-col items-center justify-center p-2 text-gray-500" data-tab="wallet">
                    <i class="fas fa-wallet text-xl"></i>
                    <span class="text-xs mt-1 font-semibold">WALLET</span>
                </button>
                <button onclick="switchTab('lists')" class="nav-btn flex flex-col items-center justify-center p-2 text-gray-500" data-tab="lists">
                    <i class="fas fa-list-check text-xl"></i>
                    <span class="text-xs mt-1 font-semibold">LISTS</span>
                </button>
                <button onclick="switchTab('info')" class="nav-btn flex flex-col items-center justify-center p-2 text-gray-500" data-tab="info">
                    <i class="fas fa-circle-info text-xl"></i>
                    <span class="text-xs mt-1 font-semibold">INFO</span>
                </button>
            </div>
        </nav>

        <!-- åœ–ç‰‡å£“ç¸®å¾Œçš„æç¤ºè¨Šæ¯ (éè­¦ç¤ºæ¡†) -->
        <div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 p-3 bg-gray-800 text-white rounded-xl shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-50">
            è¨Šæ¯æç¤º
        </div>

    </div>

    <!-- JavaScript é‚è¼¯ -->
    <script>
        // --- å…¨åŸŸå¸¸é‡èˆ‡è®Šæ•¸ ---
        const APP_ID = 'zootopia-travel-cnxtpe-2026';
        const STORAGE_KEY = {
            CHECKLIST: `${APP_ID}-checklist`,
            MEMO: `${APP_ID}-memo`,
            EXPENSES: `${APP_ID}-expenses`,
        };
        const EXCHANGE_RATE_TWD_PER_THB = 0.90; // 1 THB = 0.90 TWD

        let expenses = []; // å„²å­˜è¨˜å¸³è³‡æ–™

        // --- æ—…éŠè¡Œç¨‹è³‡æ–™ (ç¡¬ç·¨ç¢¼) ---
        const TRAVEL_DATA = {
            flights: [
                { id: 'out', date: '2026/11/21', flight: 'CI851', from: 'TPE (æ¡ƒåœ’æ©Ÿå ´)', to: 'CNX (æ¸…é‚æ©Ÿå ´)', time: '10:30 æŠµé”' },
                { id: 'return', date: '2026/11/25', flight: 'CI852', from: 'CNX (æ¸…é‚æ©Ÿå ´)', to: 'TPE (æ¡ƒåœ’æ©Ÿå ´)', time: 'å›ç¨‹' }
            ],
            accommodations: [
                { date: '11/21 - 11/23', name: 'ğŸ˜ Elephant friend', notes: 'å±±å€ä½å®¿ï¼Œè¦ªè¿‘å¤§è±¡ï¼Œæ³¨æ„é˜²èšŠ' },
                { date: '11/23 - 11/25', name: 'à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆà¸•à¸³à¸šà¸¥ à¸—à¹ˆà¸²à¸¨à¸²à¸¥à¸²', notes: 'å¸‚å€ä½å®¿ï¼Œæ–¹ä¾¿é€›è¡—èˆ‡å¤œå¸‚' }
            ],
            checklist: [
                { category: 'æˆäºº', item: 'è­·ç…§', checked: false },
                { category: 'æˆäºº', item: 'ç¶²å¡', checked: false },
                { category: 'æˆäºº', item: 'å…¥å¢ƒç”³è«‹è¡¨/é›»å­ç°½è­‰', checked: false },
                { category: 'æˆäºº', item: 'éŒ¢åŒ…', checked: false },
                { category: 'æˆäºº', item: 'è¶³å¤ ç¾é‡‘ (THB)', checked: false },
                { category: 'æˆäºº', item: 'æ›æ´—è¡£ç‰©', checked: false },
                { category: 'æˆäºº', item: 'åŒ–å¦ç›¥æ´—ç”¨å“', checked: false },
                { category: 'æˆäºº', item: 'è®Šå£“å™¨/è½‰æ¥é ­', checked: false },
                { category: 'å¯¶å¯¶', item: 'å¥¶ç“¶', checked: false },
                { category: 'å¯¶å¯¶', item: 'å¥¶ç²‰', checked: false },
                { category: 'å¯¶å¯¶', item: 'å‚™ç”¨è—¥', checked: false },
                { category: 'å¯¶å¯¶', item: 'å°¿å¸ƒ', checked: false },
                { category: 'å¯¶å¯¶', item: 'æ¿•ç´™å·¾', checked: false }
            ],
            itinerary: [
                { day: 1, date: '11/21 (å…­)', events: [
                    { time: '6:00', item: 'å‡ºç™¼: æ¡ƒåœ’æ©Ÿå ´', notes: 'CI851', type: 'flight' },
                    { time: '10:30', item: 'æŠµé”: æ¸…é‚æ©Ÿå ´', notes: 'å–è¡Œæ & è¾¦ç†ç¶²å¡', type: 'event' },
                    { time: '11:00', item: 'å–è»Š: æ¸…é‚æ©Ÿå ´', notes: 'è‡ªé§•å‰å¾€ç¬¬ä¸€ç«™', type: 'event' },
                    { time: '12:00', item: 'åˆé¤ï¼šGoodsouls Kitchen', notes: 'ç´ é£Ÿ/è¼•é£Ÿ', type: 'food', link: 'Goodsouls Kitchen, Chiang Mai' },
                    { time: '14:00', item: 'æ¡è²·è£œçµ¦å“: Rimping Supermarket (Maya)', notes: 'æ¡è²·é›¶é£Ÿé£²ç”¨æ°´', type: 'shop', link: 'Rimping Supermarket Maya' },
                    { time: '16:00', item: 'Check in: Elephant friend', notes: 'å±±å€ä½å®¿', type: 'stay' }
                    { time: '6:00', item: 'å‡ºç™¼: æ¡ƒåœ’æ©Ÿå ´', notes: 'è¯èˆªCI851ï¼Œ7:20èµ·é£›ï¼Œæ¨è»Šæ©Ÿé‚Šè¨—é‹', type: 'flight' },
                    { time: '10:25', item: 'æŠµé”: æ¸…é‚æ©Ÿå ´', notes: 'å–æ¨è»Šèˆ‡è¡Œæ', type: 'event' },
                    { time: '11:00', item: 'å–è»Š: æ¸…é‚æ©Ÿå ´', notes: 'å–è»Šåœ°é»TBD', type: 'event' },
                    { time: '12:00', item: 'åˆé¤ï¼šGoodsouls Kitchen', notes: 'æ³°åŒ—è”¬é£Ÿæ–™ç†ï¼Œæ¨è–¦å„ªæ ¼ç¢—, é¦¬éˆ´è–¯æ²é¤…, å’–å–±éºµ, é³³æ¢¨ç‚’é£¯', type: 'food', link: 'Goodsouls Kitchen, Chiang Mai' },
                    { time: '14:00', item: 'æ¡è²·è£œçµ¦å“: Rimping Supermarket (Maya)', notes: 'æ¡è²·é›¶é£Ÿé£²ç”¨æ°´ï¼Œå±±ä¸Šç„¡ä¾¿åˆ©å•†åº—ï¼Œæœ‰æ°´æœã€éºµåŒ…ã€é£Ÿæï¼Œé¡ä¼¼Jason', type: 'shop', link: 'Rimping Supermarket Maya' },
                    { time: '16:00', item: 'Check in: Elephant friend', notes: 'å±±å€ä½å®¿ï¼Œå¤©é»‘å‰æŠµé”', type: 'stay' }
                ]},
                { day: 2, date: '11/22 (æ—¥)', events: [
                    { time: '8:00', item: 'æ—©é¤: Elephant morning call', notes: 'å±±å€é™½å…‰æ—©é¤', type: 'food' },
                    { time: '8:00', item: 'æ—©é¤: Elephant morning call', notes: 'å±±å€é™½å…‰æ—©é¤å…è²»ï¼Œmorning calléœ€é ç´„', type: 'food' },
                    { time: '10:00', item: 'ä¸€æ—¥å¥—è£è¡Œç¨‹', notes: 'å¤§è±¡æ´—æ¾¡ + ç«¹ç­æ¼‚æµ + ç€‘å¸ƒé‡é¤', type: 'activity' },
                    { time: '18:00', item: 'æ™šé¤ï¼šä»˜è²»æ™šé¤', notes: 'ä½å®¿åœ°è§£æ±ºï¼Œä¼‘æ¯æ”¾é¬†', type: 'food' }
                    { time: '18:00', item: 'æ™šé¤ï¼šä»˜è²»æ™šé¤', notes: 'æ™šä¸€é»æœ‰é…’å§ï¼Œä¼‘æ¯æ”¾é¬†~', type: 'food' }
                ]},
                { day: 3, date: '11/23 (ä¸€)', events: [
                    { time: '8:00', item: 'æ—©é¤ & Check out', notes: 'æº–å‚™é›¢é–‹å±±å€', type: 'stay' },
                    { time: '11:00', item: 'æ¡è²·è£œçµ¦å“: Rimping Supermarket (Maya)', notes: 'å†æ¬¡æ¡è²·', type: 'shop', link: 'Rimping Supermarket Maya' },
                    { time: '13:00', item: 'åˆé¤: Free Bird Cafe', notes: 'å…¬ç›Šç´ é£Ÿå’–å•¡å»³', type: 'food', link: 'Free Bird Cafe, Chiang Mai' },
                    { time: '8:00', item: 'æ—©é¤ & Check out', notes: '10é»å·¦å³é›¢é–‹å±±å€', type: 'stay' },
                    { time: '11:00', item: 'æ¡è²·è£œçµ¦å“: Rimping Supermarket (Maya)', notes: 'å†æ¬¡æ¡è²·for villaè‡ªç…®/é›¶é£Ÿ', type: 'shop', link: 'Rimping Supermarket Maya' },
                    { time: '13:00', item: 'åˆé¤: Free Bird Cafe', notes: 'ç´ é£Ÿç·¬æ³°æ–™ç†ï¼Œå”åŠ©ç·¬ç”¸é›£æ°‘çš„ç¤¾æœƒä¼æ¥­', type: 'food', link: 'Free Bird Cafe, Chiang Mai' },
                    { time: '14:00', item: 'Check in: à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆà¸•à¸³à¸šà¸¥ à¸—à¹ˆà¸²à¸¨à¸²à¸¥à¸²', notes: 'å¸‚å€ä½å®¿', type: 'stay' },
                    { time: '15:00', item: 'åˆ†çµ„è¡Œå‹•', notes: 'å¢æ—é£›ç´¢/æ¸…é‚å¤œé–“å‹•ç‰©åœ’ (æ“‡ä¸€)', type: 'activity' },
                    { time: '18:00', item: 'æ™šé¤: é•·åº·è·¯å¤œå¸‚', notes: 'äº«å—ç†±é¬§å¸‚é›†å°åƒ', type: 'food', link: 'Chiang Mai Night Bazaar' },
                    { time: '20:00', item: 'æŒ‰æ‘©: Lila éº—èˆå¥³å­ç›£ç„æ³°å¼æŒ‰æ‘©', notes: 'éœ€é ç´„', type: 'activity', link: 'Lila Thai Massage' }
                    { time: '18:00', item: 'æ™šé¤: é•·åº·è·¯å¤œå¸‚', notes: 'äº«å—ç•¶åœ°å¤œå¸‚å°åƒ', type: 'food', link: 'Chiang Mai Night Bazaar' },
                    { time: '20:00', item: 'æŒ‰æ‘©: Lila éº—èˆå¥³å­ç›£ç„æ³°å¼æŒ‰æ‘©', notes: 'å¯æ–¼kkday/klookæå‰é ç´„è¼ƒä¾¿å®œ', type: 'activity', link: 'Lila Thai Massage' }
                ]},
                { day: 4, date: '11/24 (äºŒ)', events: [
                    { time: '8:00', item: 'æ—©é¤: villaå…§è‡ªç…®', notes: 'äº«å—æ‚ é–’æ™‚å…‰', type: 'food' },
                    { time: '10:00', item: 'é€›çœŸå¿ƒå¸‚é›† or è²·ä¼´æ‰‹ç¦®', notes: 'å¸‚å€æ´»å‹•', type: 'shop' },
                    { time: '12:00', item: 'åˆé¤: Aum Vegetarian Restaurant', notes: 'æ³°å¼ç´ é£Ÿæ–™ç†', type: 'food', link: 'Aum Vegetarian Restaurant' },
                    { time: '14:00', item: 'é€›å¤©ç‡ˆç¯€: Yi Peng Lantern Festival', notes: 'æº–å‚™è§€è³å¤©ç‡ˆ', type: 'activity' }
                    { time: '10:00', item: 'é€›çœŸå¿ƒå¸‚é›† or è²·ä¼´æ‰‹ç¦®', notes: 'è²·è²·è²·è²·è²·', type: 'shop' },
                    { time: '12:00', item: 'åˆé¤: Aum Vegetarian Restaurant', notes: 'æ³°å¼ç´ é£Ÿæ–™ç†ï¼Œé€™å®¶ä¸»å»šæœ¬ä¾†è¦åœ¨ä»–å€‘åœ‹å®¶æ‘˜æ˜Ÿç±³å…¶æ—çš„ã€‚å£å‘³è¶…ç´šç¨ç‰¹ï¼Œç”¨äº†éå¸¸å¤šçš„é·¹å˜´è±†ï¼Œå…¨éƒ¨éƒ½æ˜¯ç”Ÿå¹³ç¬¬ä¸€æ¬¡åƒåˆ°çš„å£å‘³ã€‚', type: 'food', link: 'Aum Vegetarian Restaurant' },
                    { time: '14:00', item: 'é€›å¤©ç‡ˆç¯€: Yi Peng Lantern Festival', notes: 'æº–å‚™è§€è³å¤©ç‡ˆï¼Œå»ºè­°å«è»Šè‡ªè¡Œå‰å¾€', type: 'activity' }
                ]},
                { day: 5, date: '11/25 (ä¸‰)', events: [
                    { time: '8:00', item: 'å›ç¨‹: æ¸…é‚æ©Ÿå ´', notes: 'CI852', type: 'flight' }
                    { time: '8:00', item: 'å›ç¨‹: æ¸…é‚æ©Ÿå ´', notes: 'è¯èˆªCI852ï¼Œ11:25èµ·é£›ï¼Œæ¨è»Šæ©Ÿé‚Šè¨—é‹', type: 'flight' }
                ]}
            ]
        };

        // --- æ ¸å¿ƒå·¥å…·å‡½å¼ ---

        /**
         * é¡¯ç¤º Toast æç¤ºè¨Šæ¯
         * @param {string} message 
         */
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 3000);
        }

        /**
         * åˆ‡æ›åˆ†é 
         * @param {string} tabId è¦åˆ‡æ›åˆ°çš„åˆ†é  ID
         */
        function switchTab(tabId) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.tab-content').forEach(section => {
                section.classList.remove('active');
            });
            // é¡¯ç¤ºç›®æ¨™å…§å®¹
            document.getElementById(tabId).classList.add('active');

            // æ›´æ–°å°èˆªåˆ—æ¨£å¼
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isCurrent = btn.getAttribute('data-tab') === tabId;
                btn.classList.toggle('text-[#4A90E2]', isCurrent);
                btn.classList.toggle('text-gray-500', !isCurrent);
                btn.classList.toggle('font-bold', isCurrent);
                btn.classList.toggle('bg-blue-50', isCurrent);
            });
            window.scrollTo(0, 0); // åˆ‡æ›æ™‚æ»¾å‹•åˆ°é ‚éƒ¨
        }

        /**
         * å„²å­˜è³‡æ–™åˆ° LocalStorage
         * @param {string} key 
         * @param {any} data 
         */
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error("Error saving to localStorage:", key, error);
            }
        }

        /**
         * å¾ LocalStorage è¼‰å…¥è³‡æ–™
         * @param {string} key 
         * @param {any} defaultValue 
         * @returns {any}
         */
        function loadFromStorage(key, defaultValue) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error("Error loading from localStorage:", key, error);
                return defaultValue;
            }
        }

        // --- 1. PLAN æ¨¡çµ„é‚è¼¯ ---

        /**
         * å–å¾—å°æ‡‰è¡Œç¨‹é¡å‹çš„åœ–ç¤º
         * @param {string} type 
         * @returns {string} Tailwind é¡è‰² class
         */
        function getTypeIcon(type) {
            switch(type) {
                case 'flight': return { icon: 'plane-departure', color: 'text-indigo-500' };
                case 'food': return { icon: 'utensils', color: 'text-orange-500' };
                case 'shop': return { icon: 'basket-shopping', color: 'text-green-500' };
                case 'stay': return { icon: 'house-chimney', color: 'text-blue-500' };
                case 'activity': return { icon: 'person-hiking', color: 'text-red-500' };
                default: return { icon: 'circle', color: 'text-gray-400' };
            }
        }

        /**
         * æ¸²æŸ“è¡Œç¨‹è¡¨
         */
        function renderItinerary() {
            const container = document.getElementById('itinerary-container');
            let html = `
                <div class="bg-gray-100 p-4 rounded-2xl shadow-inner text-center mb-6">
                    <p class="font-bold text-lg text-[#4A90E2]">ğŸ›« èˆªç­è³‡è¨Š & ğŸ  ä½å®¿è³‡è¨Š</p>
                    <p class="text-sm mt-1">å»ç¨‹: ${TRAVEL_DATA.flights[0].date} ${TRAVEL_DATA.flights[0].flight} ${TRAVEL_DATA.flights[0].from} â†’ ${TRAVEL_DATA.flights[0].to}</p>
                    <p class="text-sm">å›ç¨‹: ${TRAVEL_DATA.flights[1].date} ${TRAVEL_DATA.flights[1].flight} ${TRAVEL_DATA.flights[1].from} â†’ ${TRAVEL_DATA.flights[1].to}</p>
                    <p class="text-sm mt-2 font-semibold">ä½å®¿: ${TRAVEL_DATA.accommodations.map(a => `${a.date} (${a.name})`).join(' | ')}</p>
                </div>
            `;

            TRAVEL_DATA.itinerary.forEach(dayPlan => {
                html += `
                    <div class="mb-8 p-4 bg-white rounded-3xl shadow-xl border-t-8 border-[#90c74b]">
                        <h3 class="text-xl font-extrabold text-[#6B8E23] mb-4">${dayPlan.date} (Day ${dayPlan.day})</h3>
                        <div class="relative pl-6">
                            <div class="absolute top-0 left-0 bottom-0 w-1 bg-gray-200 rounded-full"></div>
                            ${dayPlan.events.map(event => {
                                const { icon, color } = getTypeIcon(event.type);
                                return `
                                    <div class="relative mb-6">
                                        <div class="absolute -left-3 top-0 w-6 h-6 rounded-full ${color} flex items-center justify-center shadow-md">
                                            <i class="fas fa-${icon} text-white text-xs"></i>
                                        </div>
                                        <div class="ml-4 pt-1">
                                            <p class="text-sm font-bold text-gray-700">${event.time}</p>
                                            <p class="text-lg font-extrabold text-[#4A90E2]">${event.item}</p>
                                            <p class="text-sm text-gray-500">${event.notes}</p>
                                            ${event.link ? `
                                                <div class="mt-2 space-x-2">
                                                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.link)}" target="_blank" class="text-xs text-white bg-red-500 hover:bg-red-600 rounded-full px-3 py-1 shadow-md">
                                                        <i class="fas fa-location-dot mr-1"></i> Google Maps
                                                    </a>
                                                    <a href="https://www.google.com/search?q=${encodeURIComponent(event.link + ' é£Ÿè¨˜')}" target="_blank" class="text-xs text-white bg-orange-400 hover:bg-orange-500 rounded-full px-3 py-1 shadow-md">
                                                        <i class="fas fa-book-open-reader mr-1"></i> æŸ¥çœ‹é£Ÿè¨˜
                                                    </a>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // --- 3. WALLET æ¨¡çµ„é‚è¼¯ ---

        /**
         * åŒ¯ç‡è¨ˆç®—æ©Ÿé‚è¼¯
         */
        function calculateCurrency() {
            const input = document.getElementById('calcInput').value;
            const resultDiv = document.getElementById('calcResult');

            if (!input) {
                resultDiv.innerHTML = `<span class="text-red-500 font-bold">è«‹è¼¸å…¥ç®—å¼ï¼</span>`;
                return;
            }

            try {
                // å®‰å…¨åœ°åŸ·è¡Œç®—å¼
                const amountTHB = Function('return ' + input)();

                if (isNaN(amountTHB) || amountTHB === null) {
                    throw new Error("Invalid calculation");
                }

                const amountTWD = (amountTHB * EXCHANGE_RATE_TWD_PER_THB).toFixed(2);

                resultDiv.innerHTML = `
                    <div class="font-extrabold text-2xl text-[#6B8E23]">${amountTHB.toFixed(2)} THB</div>
                    <div class="text-sm text-gray-500 mt-1">=</div>
                    <div class="font-extrabold text-2xl text-[#4A90E2]">${amountTWD} TWD</div>
                `;

            } catch (e) {
                resultDiv.innerHTML = `<span class="text-red-500 font-bold">ç®—å¼éŒ¯èª¤æˆ–çµæœç„¡æ•ˆï¼</span>`;
                console.error("Calculation error:", e);
            }
        }

        /**
         * å£“ç¸®ä¸¦è½‰æ›åœ–ç‰‡ç‚º Base64 ç¸®åœ– (Canvas)
         * @param {File} file 
         * @returns {Promise<string>} Base64 åœ–ç‰‡è³‡æ–™
         */
        function compressImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 200; // ç¸®åœ–æœ€å¤§å¯¬åº¦
                        let width = img.width;
                        let height = img.height;

                        if (width > MAX_WIDTH) {
                            height = height * (MAX_WIDTH / width);
                            width = MAX_WIDTH;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // è½‰æ›ç‚º Base64 (JPEG, å£“ç¸®å“è³ª 70%)
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    img.onerror = reject;
                    img.src = event.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        /**
         * è™•ç†è¨˜å¸³è¡¨å–®æäº¤
         * @param {Event} e 
         */
        async function handleExpenseSubmit(e) {
            e.preventDefault();

            const item = document.getElementById('expenseItem').value.trim();
            const amountTHB = parseFloat(document.getElementById('expenseAmount').value);
            const photoFile = document.getElementById('expensePhoto').files[0];

            if (item === "" || isNaN(amountTHB) || amountTHB <= 0) {
                showToast("è«‹è¼¸å…¥æœ‰æ•ˆçš„å“é …åç¨±å’Œé‡‘é¡ï¼");
                return;
            }

            let photoBase64 = null;
            if (photoFile) {
                showToast("æ­£åœ¨è™•ç†åœ–ç‰‡ï¼Œè«‹ç¨å€™...");
                try {
                    photoBase64 = await compressImage(photoFile);
                    showToast("åœ–ç‰‡è™•ç†å®Œæˆï¼");
                } catch (error) {
                    console.error("Image processing failed:", error);
                    showToast("åœ–ç‰‡è™•ç†å¤±æ•—ï¼Œè¨˜éŒ„å·²å„²å­˜ä½†ç„¡åœ–ç‰‡ã€‚");
                }
            }

            const newExpense = {
                id: Date.now(),
                item,
                amountTHB: amountTHB.toFixed(2),
                amountTWD: (amountTHB * EXCHANGE_RATE_TWD_PER_THB).toFixed(2),
                photoBase64,
                timestamp: new Date().toLocaleString('zh-TW', { hour12: false })
            };

            expenses.push(newExpense);
            saveToStorage(STORAGE_KEY.EXPENSES, expenses);
            renderExpenseList();

            // é‡è¨­è¡¨å–®
            e.target.reset();
            document.getElementById('photoStatus').textContent = 'æœªé¸å–åœ–ç‰‡';
        }

        /**
         * æ¸²æŸ“è¨˜å¸³åˆ—è¡¨
         */
        function renderExpenseList() {
            const listContainer = document.getElementById('expenseList');
            let totalTHB = 0;
            let totalTWD = 0;

            if (expenses.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-gray-400 p-4">å°šç„¡æ¶ˆè²»è¨˜éŒ„ã€‚</p>`;
                return;
            }

            const listHTML = expenses.reverse().map(exp => {
                totalTHB += parseFloat(exp.amountTHB);
                totalTWD += parseFloat(exp.amountTWD);

                return `
                    <div class="flex items-center bg-gray-50 p-3 rounded-xl shadow-sm hover:shadow-md transition-shadow">
                        ${exp.photoBase64 ? `
                            <img src="${exp.photoBase64}" class="w-12 h-12 object-cover rounded-lg mr-3 shadow-md border-2 border-[#F7D754] flex-shrink-0" alt="æ”¶æ“šç¸®åœ–">
                        ` : `
                            <div class="w-12 h-12 bg-gray-300 rounded-lg mr-3 flex items-center justify-center text-gray-500 flex-shrink-0">
                                <i class="fas fa-image text-xl"></i>
                            </div>
                        `}
                        <div class="flex-grow min-w-0">
                            <p class="font-bold text-gray-800 truncate">${exp.item}</p>
                            <p class="text-xs text-gray-400">${exp.timestamp}</p>
                        </div>
                        <div class="text-right ml-4 flex-shrink-0">
                            <p class="font-extrabold text-[#6B8E23] text-lg">${exp.amountTHB} THB</p>
                            <p class="text-sm text-[#4A90E2] font-semibold">â‰ˆ ${exp.amountTWD} TWD</p>
                        </div>
                        <button onclick="deleteExpense(${exp.id})" class="ml-3 text-red-400 hover:text-red-600 transition-colors flex-shrink-0">
                            <i class="fas fa-trash-alt text-sm"></i>
                        </button>
                    </div>
                `;
            }).join('');

            listContainer.innerHTML = listHTML;

            // ç¸½è¨ˆé¡¯ç¤ºåœ¨åˆ—è¡¨ä¸Šæ–¹
            listContainer.insertAdjacentHTML('beforebegin', `
                <div id="expenseTotal" class="p-3 mb-4 bg-[#F7D754] text-gray-800 rounded-xl shadow-md font-extrabold text-center">
                    <p class="text-sm">ç¸½è¨ˆæ¶ˆè²»:</p>
                    <p class="text-xl">${totalTHB.toFixed(2)} THB â‰ˆ ${totalTWD.toFixed(2)} TWD</p>
                </div>
            `);

            // ç§»é™¤èˆŠçš„ç¸½è¨ˆä»¥é˜²é‡è¤‡
            const oldTotal = document.getElementById('expenseTotal');
            if (oldTotal) oldTotal.remove();
        }

        /**
         * åˆªé™¤å–®ç­†è¨˜å¸³è¨˜éŒ„
         * @param {number} id 
         */
        function deleteExpense(id) {
            expenses = expenses.filter(exp => exp.id !== id);
            saveToStorage(STORAGE_KEY.EXPENSES, expenses);
            renderExpenseList();
            showToast("è¨˜éŒ„å·²åˆªé™¤ã€‚");
        }

        // ç›£è½åœ–ç‰‡é¸æ“‡äº‹ä»¶ï¼Œæ›´æ–°ç‹€æ…‹æ–‡å­—
        document.addEventListener('DOMContentLoaded', () => {
            const photoInput = document.getElementById('expensePhoto');
            if(photoInput) {
                photoInput.addEventListener('change', () => {
                    const status = document.getElementById('photoStatus');
                    if (photoInput.files.length > 0) {
                        status.textContent = `å·²é¸å–: ${photoInput.files[0].name}`;
                    } else {
                        status.textContent = 'æœªé¸å–åœ–ç‰‡';
                    }
                });
            }
        });

        // --- 4. LISTS æ¨¡çµ„é‚è¼¯ ---

        /**
         * æ¸²æŸ“ä¸¦åˆå§‹åŒ– CheckList
         */
        function renderChecklist() {
            let listData = loadFromStorage(STORAGE_KEY.CHECKLIST, TRAVEL_DATA.checklist);
            const container = document.getElementById('checklistContainer');
            let html = '';

            let currentCategory = '';
            listData.forEach((item, index) => {
                if (item.category !== currentCategory) {
                    html += `<h4 class="text-lg font-bold text-gray-600 mt-3 mb-1">${item.category} æ¸…å–®</h4>`;
                    currentCategory = item.category;
                }
                html += `
                    <label class="flex items-center p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors">
                        <input type="checkbox" data-index="${index}" ${item.checked ? 'checked' : ''} 
                               onchange="toggleChecklistItem(${index})" 
                               class="form-checkbox h-5 w-5 text-[#90c74b] rounded border-gray-300 focus:ring-[#90c74b]">
                        <span class="ml-3 text-base text-gray-700 ${item.checked ? 'line-through text-gray-400' : ''}">${item.item}</span>
                    </label>
                `;
            });
            container.innerHTML = html;
        }

        /**
         * åˆ‡æ› CheckList ç‹€æ…‹ä¸¦å„²å­˜
         * @param {number} index 
         */
        function toggleChecklistItem(index) {
            let listData = loadFromStorage(STORAGE_KEY.CHECKLIST, TRAVEL_DATA.checklist);
            listData[index].checked = !listData[index].checked;
            saveToStorage(STORAGE_KEY.CHECKLIST, listData);
            renderChecklist(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æ¨£å¼
        }

        /**
         * å„²å­˜å‚™å¿˜éŒ„
         */
        function saveMemo() {
            const textarea = document.getElementById('memoTextarea');
            const text = textarea.value;
            saveToStorage(STORAGE_KEY.MEMO, text);
            renderMemoPreview(text);
            showToast("å‚™å¿˜éŒ„å·²å„²å­˜ï¼");
        }

        /**
         * æ¸²æŸ“å‚™å¿˜éŒ„é è¦½ä¸¦è½‰æ›ç¶²å€
         * @param {string} text 
         */
        function renderMemoPreview(text) {
            const previewDiv = document.getElementById('memoPreview');
            // æ­£å‰‡è¡¨é”å¼åŒ¹é… URL
            const urlRegex = /(https?:\/\/[^\s]+)/g;

            // å°‡ç´”æ–‡å­—å…§å®¹åˆ†è¡Œè™•ç†ï¼Œä¸¦å°‡ URL æ›¿æ›ç‚ºæŒ‰éˆ•
            const processedText = text.replace(urlRegex, (url) => {
                return `<a href="${url}" target="_blank" class="inline-block mt-1 text-xs text-white bg-[#4A90E2] hover:bg-[#3d7bd4] rounded-full px-3 py-1 shadow-md">
                            <i class="fas fa-link mr-1"></i> ${url.length > 30 ? url.substring(0, 30) + '...' : url}
                        </a>`;
            });

            previewDiv.innerHTML = processedText || '<p class="text-center text-gray-400">å°šç„¡å‚™å¿˜éŒ„å…§å®¹ã€‚</p>';
        }

        /**
         * å¾ LocalStorage è¼‰å…¥å‚™å¿˜éŒ„
         */
        function loadMemo() {
            const text = loadFromStorage(STORAGE_KEY.MEMO, '');
            document.getElementById('memoTextarea').value = text;
            renderMemoPreview(text);
        }

        // --- åˆå§‹åŒ–å…¨éƒ¨åŠŸèƒ½ ---

        window.onload = function() {
            // 1. ç¢ºä¿ç¬¬ä¸€å€‹åˆ†é å•Ÿå‹•
            switchTab('plan'); 

            // 2. æ¸²æŸ“ PLAN æ¨¡çµ„
            renderItinerary();

            // 3. åˆå§‹åŒ– WALLET æ¨¡çµ„
            expenses = loadFromStorage(STORAGE_KEY.EXPENSES, []);
            renderExpenseList();
            document.getElementById('expenseForm').addEventListener('submit', handleExpenseSubmit);

            // 4. åˆå§‹åŒ– LISTS æ¨¡çµ„
            renderChecklist();
            loadMemo();
        };


    </script>
</body>
</html>
